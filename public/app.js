!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n,r,a=function(){function t(){}return t.canvasWidth=0,t.canvasHeight=0,t.lineWidth=4,t.fps=80,t.angleModifier=2,t.pixelsPerSecond=100,t.scoreBoardWith=150,t.holeSize=10,t.holeFrequency=10,t}();function o(t,e){return Math.floor(Math.random()*(e-t+1))+t}!function(t){t[t.One=49]="One",t[t.Q=81]="Q",t[t.LAlt=17]="LAlt",t[t.RAlt=18]="RAlt",t[t.M=77]="M",t[t.Comma=188]="Comma",t[t.P=80]="P",t[t.SZ=189]="SZ",t[t.Left=37]="Left",t[t.Down=40]="Down",t[t.Space=32]="Space",t[t.Enter=13]="Enter",t[t.Y=89]="Y",t[t.X=88]="X"}(n||(n={})),function(t){t.Left="Left",t.Right="Right"}(r||(r={}));var s,h=function(){function t(){}return t.addEventListener=function(t,e,i,n){var r=function(t){return n(t)};e.addEventListener(i,r),this.eventCallbacks.set(t,{node:e,eventName:i,callback:r})},t.removeEventListener=function(t){var e=this.eventCallbacks.get(t);e&&(e.node.removeEventListener(e.eventName,e.callback),this.eventCallbacks.delete(t))},t.oneTimeEventListener=function(t,e,i){var n=function(r){return t.removeEventListener(e,n),i(r)};t.addEventListener(e,n)},t.eventCallbacks=new Map,t}(),l=function(){function t(t,e){this.interval=0,this.stepsUntilHolePerPlayer=new Map,this.holeSizePerPlayer=new Map,this.speed=a.pixelsPerSecond*(1e3/a.fps/1e3),this.playerRanks=[],this.canvasContext=t,this.players=e}return t.prototype.start=function(){var t=this;return this.interval?new Promise(function(t){return t([])}):new Promise(function(e,i){t.resolveCallback=e,t.playerRanks=[],t.draw(),t.draw(),t.draw(),t.draw(),h.addEventListener("draw",document,"keydown",t.startDrawingIntervalEvent.bind(t))})},t.prototype.startDrawingIntervalEvent=function(t){var e=this;t.keyCode!==n.Space&&t.keyCode!==n.Enter||this.interval||(this.interval=window.setInterval(function(){h.removeEventListener("draw"),e.draw()},1e3/a.fps))},t.prototype.stop=function(){clearInterval(this.interval),this.interval=0,this.resolveCallback&&this.resolveCallback(this.playerRanks)},t.prototype.draw=function(){var t=this;this.players.filter(function(t){return t.isActive&&t.isAlive}).forEach(function(e){e.isTurningLeft&&(e.angle-=a.angleModifier),e.isTurningRight&&(e.angle+=a.angleModifier);var i=Math.cos(e.angle*Math.PI/180)*t.speed,n=Math.sin(e.angle*Math.PI/180)*t.speed;if(t.hitTest({x:e.xPosition+i,y:e.yPosition+n})){t.playerRanks.unshift(e),e.isAlive=!1;var r=t.players.filter(function(t){return t.isAlive});r.length<2&&(r.forEach(function(e){t.playerRanks.unshift(e)}),t.stop())}if(t.stepsUntilHolePerPlayer.has(e.id)||t.stepsUntilHolePerPlayer.set(e.id,t.getStepsUntilNextHole()),0===t.stepsUntilHolePerPlayer.get(e.id))if(t.holeSizePerPlayer.has(e.id)){var o=(t.holeSizePerPlayer.get(e.id)||0)+1;t.holeSizePerPlayer.set(e.id,o),o>=a.holeSize&&(t.stepsUntilHolePerPlayer.set(e.id,t.getStepsUntilNextHole()),t.holeSizePerPlayer.set(e.id,0))}else t.holeSizePerPlayer.set(e.id,0);else t.stepsUntilHolePerPlayer.set(e.id,(t.stepsUntilHolePerPlayer.get(e.id)||1)-1),t.canvasContext.strokeStyle=e.color,t.canvasContext.fillStyle=e.color,t.canvasContext.beginPath(),t.canvasContext.lineWidth=a.lineWidth,t.canvasContext.moveTo(e.xPosition,e.yPosition),t.canvasContext.lineTo(e.xPosition+i,e.yPosition+n),t.canvasContext.stroke();e.xPosition+=i,e.yPosition+=n})},t.prototype.getStepsUntilNextHole=function(){return Math.floor(o(1,100)*(100/a.holeFrequency))},t.prototype.hitTest=function(t){return t.x>a.canvasWidth||t.y>a.canvasHeight||t.x<0||t.y<0||this.canvasContext.getImageData(t.x,t.y,1,1).data[3]>100},t}(),d=function(){function t(){}return t.minStrength=1.5,t.maxStrength=7,t.minTrails=10,t.maxTrails=30,t.gravity=.05,t.airResistance=.001,t.numberOfStars=150,t.fireworkLifeTime=150,t.trailLength=150,t.delay=.5,t}(),c=function(){function t(t,e,i,n,r,a,o,s){this.drawingContext=t,this.x=e,this.y=i,this.vx=n,this.vy=r,this.ax=a,this.ay=o,this.color=s,this.lifeTime=d.fireworkLifeTime,this.radius=3,this.path=[]}return t.prototype.update=function(){this.lifeTime--,this.path.length>=d.trailLength&&this.path.shift(),this.path.push([this.x,this.y]),this.vy+=this.ay,this.vx+=this.ax,this.x+=this.vx,this.y+=this.vy},t.prototype.draw=function(){var t=Math.trunc(100*this.lifeTime/d.fireworkLifeTime)/100;this.drawingContext.fillStyle="rgba("+this.color+","+.4*t+")",this.lifeTime>.95*d.fireworkLifeTime&&(this.drawingContext.fillStyle="#fff"),this.drawingContext.lineWidth=40,this.drawingContext.beginPath(),this.drawingContext.moveTo(this.x-this.radius,this.y),this.drawingContext.lineTo(this.path[0][0],this.path[0][1]),this.drawingContext.lineTo(this.x+this.radius,this.y),this.drawingContext.closePath(),this.drawingContext.fill(),this.drawingContext.fillStyle="rgba("+this.color+","+t+")",this.lifeTime>.95*d.fireworkLifeTime&&(this.drawingContext.fillStyle="#fff"),this.drawingContext.beginPath(),this.drawingContext.arc(Math.trunc(this.x),Math.trunc(this.y),this.radius,0,2*Math.PI),this.drawingContext.fill(),this.drawingContext.closePath()},t}(),f=function(){function t(t){this.drawingContext=t,this.x=a.canvasWidth*(.8*Math.random()+.1),this.y=a.canvasHeight*(.8*Math.random()+.1),this.strength=Math.random()*(d.maxStrength-d.minStrength)+d.minStrength,this.color=Math.trunc(255*Math.random())+","+Math.trunc(255*Math.random())+","+Math.trunc(255*Math.random()),this.life=0,this.particles=[];for(var e=~~(Math.random()*(d.maxTrails-d.minTrails))+d.minTrails,i=d.gravity,n=e;n--;){var r=d.airResistance,o=n*Math.PI*2/e;o<Math.PI&&(r*=-1);var s=this.strength*Math.sin(o),h=this.strength*Math.cos(o);this.particles.push(new c(t,this.x,this.y,s,h,r,i,this.color))}}return t.prototype.update=function(){if(this.life++,!(this.life<0))for(var t=this.particles.length;t--;)this.particles[t].update(),this.particles[t].draw()},t}(),u=function(){function t(t){this.drawingContext=t,this.maxStarRadius=3,this.flashingFactor=.4,this.x=Math.random()*a.canvasWidth,this.y=Math.random()*a.canvasHeight,this.r=Math.random()*this.maxStarRadius,this.b=Math.trunc(100*Math.random())/100}return t.prototype.draw=function(){this.b+=this.flashingFactor*(Math.random()-.5),this.drawingContext.fillStyle="rgba(255,255,255,"+this.b+")",this.drawingContext.beginPath(),this.drawingContext.arc(Math.trunc(this.x),Math.trunc(this.y),this.r,0,2*Math.PI),this.drawingContext.fill(),this.drawingContext.closePath()},t}(),g=function(){function t(t,e){this.drawingContext=t,this.withStars=e,this.stars=[],this.isRunning=!1,this.mainWithThis=this.main.bind(this),this.firework1=new f(this.drawingContext),this.firework2=new f(this.drawingContext),this.firework2.life=-d.fireworkLifeTime-d.delay,this.withStars&&this.createStars()}return t.prototype.start=function(){this.saveDrawingSurface(),this.isRunning=!0,this.main()},t.prototype.stop=function(){this.isRunning=!1,this.animationId&&window.cancelAnimationFrame(this.animationId)},t.prototype.createStars=function(){for(var t=0;t<d.numberOfStars;t++)this.stars.push(new u(this.drawingContext))},t.prototype.main=function(){this.isRunning&&(this.restoreDrawingSurface(),this.stars.forEach(function(t){t.draw()}),this.firework1.update(),this.firework2.update(),this.firework1.life===d.fireworkLifeTime*d.delay&&(this.firework2=new f(this.drawingContext)),this.firework2.life===d.fireworkLifeTime*d.delay&&(this.firework1=new f(this.drawingContext)),this.isRunning&&(this.animationId=window.requestAnimationFrame(this.mainWithThis)))},t.prototype.saveDrawingSurface=function(){this.previousState=this.drawingContext.getImageData(0,0,a.canvasWidth,a.canvasHeight)},t.prototype.restoreDrawingSurface=function(){this.previousState&&this.drawingContext.putImageData(this.previousState,0,0)},t}(),y=function(){function t(t,e){this.drawingContext=t,this.playerManager=e,this.frameLineWidth=5,this.fireworkService=new g(this.drawingContext,!1),this.drawKeySettings()}return t.prototype.startGameEventListener=function(t){if(t.keyCode===n.Space||t.keyCode===n.Enter){if(this.playerManager.getNumberOfActivePlayers()<2)return;this.drawGameFrames(),this.gameEngine=new l(this.drawingContext,this.playerManager.getPlayers()),this.playerManager.initializePlayers(),this.startRound(),h.removeEventListener("toggle-ready-keyboard"),h.removeEventListener("toggle-ready-mouse"),h.removeEventListener("start-game")}},t.prototype.startRound=function(){var t=this;this.drawPlayingFieldFrame(),this.playerManager.initializePlayers(),this.gameEngine&&this.gameEngine.start().then(function(e){t.playerManager.updateScores(e),t.drawScoreboard(),t.playerManager.getHighestScore()>=t.getMaxScore()?t.drawWinningScreen():h.addEventListener("start-new-round",document,"keydown",t.startNextRoundKeyboardEvent.bind(t))})},t.prototype.startNextRoundKeyboardEvent=function(t){t.keyCode!==n.Space&&t.keyCode!==n.Enter||this.gameEngine&&(h.removeEventListener("start-new-round"),this.startRound())},t.prototype.drawWinningScreen=function(){var t=this;this.drawingContext.textAlign="middle";this.drawingContext.font="40px Fredericka the Great, cursive";var e=this.playerManager.getPlayers().filter(function(e){return e.score===t.playerManager.getHighestScore()}),i=e.map(function(t){return t.name}).join(", ")+" won !!!",n=this.drawingContext.measureText(i).width,r=(a.canvasWidth-a.scoreBoardWith)/2-n/2;e.forEach(function(i,n){t.drawingContext.fillStyle=i.color;var o=i.name+(n<e.length-1?", ":"");t.drawingContext.fillText(o,r,a.canvasHeight/2+20),r+=t.drawingContext.measureText(o).width}),this.drawingContext.fillStyle="#ffffff";this.drawingContext.fillText(" won !!!",r,a.canvasHeight/2+20),this.fireworkService.start(),this.playerManager.resetActiveStatus(),this.playerManager.resetScores(),h.addEventListener("start-new-game",document,"keydown",this.startNewGameKeyboardEvent.bind(this))},t.prototype.startNewGameKeyboardEvent=function(t){t.keyCode!==n.Space&&t.keyCode!==n.Enter||(h.removeEventListener("start-new-game"),this.fireworkService.stop(),this.drawKeySettings())},t.prototype.drawKeySettings=function(){var t=this;this.drawingContext.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.drawingContext.lineWidth=this.frameLineWidth,this.drawingContext.strokeStyle="#6E6E6E",this.drawingContext.strokeRect(this.frameLineWidth/2,this.frameLineWidth/2,a.canvasWidth-this.frameLineWidth,a.canvasHeight-this.frameLineWidth),this.playerManager.getPlayers().forEach(function(e,i){t.drawingContext.textAlign="middle";t.drawingContext.font="20px Fredericka the Great, cursive",t.drawingContext.fillStyle=e.color,t.drawingContext.fillText("( "+t.getKeyName(e.leftControl)+"  "+t.getKeyName(e.rightControl)+" )",100,a.canvasHeight/(t.playerManager.getPlayers().length+2)*(i+1)-20/3)}),this.drawingContext.textAlign="middle";this.drawingContext.font="lighter 16px Helvetica, Arial, sans-serif",this.drawingContext.fillStyle="#ffffff";var e="If 2 or more players have joined, start the game by pressing Space or Enter",i=this.drawingContext.measureText(e).width;this.drawingContext.fillText(e,a.canvasWidth/2-i/2,a.canvasHeight-50),h.addEventListener("toggle-ready-keyboard",document,"keydown",this.togglePlayerReadyStateKeyboard.bind(this)),h.addEventListener("toggle-ready-mouse",document,"mousedown",this.togglePlayerReadyStateMouse.bind(this)),h.addEventListener("start-game",document,"keydown",this.startGameEventListener.bind(this))},t.prototype.togglePlayerReadyStateMouse=function(t){var e;(t.preventDefault(),0===t.button)&&((e=this.playerManager.getPlayers().find(function(t){return t.leftControl===r.Left}))&&this.drawPlayerReadyState(e,!0));2===t.button&&((e=this.playerManager.getPlayers().find(function(t){return t.rightControl===r.Right}))&&this.drawPlayerReadyState(e,!1))},t.prototype.togglePlayerReadyStateKeyboard=function(t){var e=this.playerManager.getPlayers().find(function(e){return e.leftControl===t.keyCode});e&&this.drawPlayerReadyState(e,!0);var i=this.playerManager.getPlayers().find(function(e){return e.rightControl===t.keyCode});i&&this.drawPlayerReadyState(i,!1)},t.prototype.drawPlayerReadyState=function(t,e){this.drawingContext.textAlign="middle";this.drawingContext.font="20px Fredericka the Great, cursive",this.drawingContext.fillStyle=t.color;var i=this.playerManager.getPlayers().findIndex(function(e){return e===t}),n=a.canvasHeight/(this.playerManager.getPlayers().length+2)*(i+1)-20/3;this.drawingContext.clearRect(390,n-20,100,25),t.isActive=e,e&&this.drawingContext.fillText("READY",400,n)},t.prototype.getKeyName=function(t){switch(t){case n.One:return"1";case n.Q:return"Q";case n.LAlt:return"L . Alt";case n.RAlt:return"R . Alt";case n.M:return"M";case n.Comma:return",";case n.P:return"P";case n.SZ:return"ÃŸ";case n.Left:return"L . Arrow";case n.Down:return"D . Arrow";case n.Y:return"Y";case n.X:return"X";case r.Left:return"L . Mouse";case r.Right:return"R . Mouse";default:return""}},t.prototype.drawScoreboard=function(){var t=this;this.drawingContext.clearRect(a.canvasWidth-a.scoreBoardWith,0,a.canvasWidth,a.canvasHeight),this.drawingContext.beginPath(),this.drawingContext.rect(a.canvasWidth-a.scoreBoardWith,this.frameLineWidth/2,a.scoreBoardWith-this.frameLineWidth/2,a.canvasHeight-this.frameLineWidth),this.drawingContext.fillStyle="#3C3C3C",this.drawingContext.fill(),this.drawingContext.lineWidth=this.frameLineWidth,this.drawingContext.strokeStyle="#6E6E6E",this.drawingContext.stroke(),this.playerManager.getPlayers().forEach(function(e,i){if(e.isActive){t.drawingContext.textAlign="middle";var n=a.canvasHeight/(t.playerManager.getPlayers().length+2);t.drawingContext.font=n+"px Fredericka the Great, cursive",t.drawingContext.fillStyle=e.color,t.drawingContext.fillText((""+e.score).padStart(2," "),a.canvasWidth-a.scoreBoardWith/1.25-4*t.frameLineWidth,a.canvasHeight/t.playerManager.getPlayers().length*(i+1)-n/3)}})},t.prototype.drawGameFrames=function(){this.drawPlayingFieldFrame(),this.drawScoreboard()},t.prototype.drawPlayingFieldFrame=function(){this.drawingContext.clearRect(0,0,a.canvasWidth-a.scoreBoardWith,a.canvasHeight),this.drawingContext.lineWidth=this.frameLineWidth,this.drawingContext.strokeStyle="#6E6E6E",this.drawingContext.strokeRect(this.frameLineWidth/2,this.frameLineWidth/2,a.canvasWidth-a.scoreBoardWith-this.frameLineWidth/2,a.canvasHeight-this.frameLineWidth)},t.prototype.getMaxScore=function(){return 10*(this.playerManager.getNumberOfActivePlayers()-1)},t}(),p=function(){function t(){this.players=new Map}return t.prototype.addPlayer=function(t){if(this.players.has(t.id))throw new Error("Player with given Id already existing");this.players.set(t.id,t),this.bindKeyboardControls(t)},t.prototype.removePlayer=function(t){this.players.delete(t.id)},t.prototype.initializePlayers=function(){Array.from(this.players.values()).filter(function(t){return t.isActive}).forEach(function(t){t.xPosition=o((a.canvasWidth-a.scoreBoardWith)/5,4*(a.canvasWidth-a.scoreBoardWith)/5),t.yPosition=o(a.canvasHeight/5,4*a.canvasHeight/5),t.angle=360*Math.random(),t.isAlive=!0})},t.prototype.bindKeyboardControls=function(t){document.addEventListener("keydown",function(e){e.preventDefault(),e.keyCode===t.leftControl&&(t.isTurningLeft=!0),e.keyCode===t.rightControl&&(t.isTurningRight=!0)}),document.addEventListener("keyup",function(e){e.preventDefault(),e.keyCode===t.leftControl&&(t.isTurningLeft=!1),e.keyCode===t.rightControl&&(t.isTurningRight=!1)}),document.addEventListener("mousedown",function(e){e.preventDefault(),0===e.button&&(t.leftControl===r.Left&&(t.isTurningLeft=!0),t.rightControl===r.Left&&(t.isTurningRight=!0)),2===e.button&&(t.leftControl===r.Right&&(t.isTurningLeft=!0),t.rightControl===r.Right&&(t.isTurningRight=!0))}),document.addEventListener("mouseup",function(e){e.preventDefault(),0===e.button&&(t.leftControl===r.Left&&(t.isTurningLeft=!1),t.rightControl===r.Left&&(t.isTurningRight=!1)),2===e.button&&(t.leftControl===r.Right&&(t.isTurningLeft=!1),t.rightControl===r.Right&&(t.isTurningRight=!1))})},t.prototype.getPlayers=function(){return Array.from(this.players.values())},t.prototype.getNumberOfActivePlayers=function(){return this.getPlayers().filter(function(t){return t.isActive}).length},t.prototype.updateScores=function(t){var e=this;t.forEach(function(t,i){t.score+=e.getNumberOfActivePlayers()-i-1})},t.prototype.getHighestScore=function(){var t=Array.from(this.players.values()).map(function(t){return t.score});return Math.max.apply(Math,t)},t.prototype.resetActiveStatus=function(){Array.from(this.players.values()).forEach(function(t){t.isActive=!1})},t.prototype.resetScores=function(){Array.from(this.players.values()).forEach(function(t){t.score=0})},t}(),v=function(){function t(t,e,i,n,r){this._xPosition=0,this._yPosition=0,this._angle=0,this._isAlive=!1,this._score=0,this._isTurningLeft=!1,this._isTurningRight=!1,this._isActive=!1,this._id=t,this._name=e,this._color=i,this._leftControl=n,this._rightControl=r}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xPosition",{get:function(){return this._xPosition},set:function(t){this._xPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yPosition",{get:function(){return this._yPosition},set:function(t){this._yPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAlive",{get:function(){return this._isAlive},set:function(t){this._isAlive=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTurningLeft",{get:function(){return this._isTurningLeft},set:function(t){this._isTurningLeft=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTurningRight",{get:function(){return this._isTurningRight},set:function(t){this._isTurningRight=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftControl",{get:function(){return this._leftControl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightControl",{get:function(){return this._rightControl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(t){this._isActive=t},enumerable:!0,configurable:!0}),t}();!function(t){t.Red="#CC361F",t.Yellow="#DBDE4B",t.Orange="#EC7B34",t.Green="#5FD441",t.Pink="#DA4FAF",t.Blue="#4AAAD7"}(s||(s={})),window.onload=function(){a.canvasWidth=document.body.clientWidth-20,a.canvasHeight=document.body.clientHeight-50;var t,e=document.getElementById("canvas");if(!e)throw new Error("No canvas element found");if(e.width=a.canvasWidth,e.height=a.canvasHeight,!e.getContext)throw new Error("No canvas support");t=e.getContext("2d"),function(){t.lineWidth=5,t.strokeStyle="#6E6E6E",t.strokeRect(2.5,2.5,a.canvasWidth-5,a.canvasHeight-5),t.textAlign="middle";var e=a.canvasHeight/10;t.font=e+"px Fredericka the Great, cursive",t.fillStyle="#ffffff";var i="Achtung, die Kurve !",n=t.measureText(i).width;t.fillText(i,a.canvasWidth/2-n/2,a.canvasHeight/2+e/2),t.textAlign="middle",t.font="lighter 16px Helvetica, Arial, sans-serif",t.fillStyle="#ffffff",i="Press any key to continue",n=t.measureText(i).width,t.fillText(i,a.canvasWidth/2-n/2,a.canvasHeight-50)}(),h.oneTimeEventListener(document,"keydown",function(){var e=new p,i=new v(1,"Player 1",s.Red,n.One,n.Q);e.addPlayer(i);var a=new v(2,"Player 2",s.Yellow,n.Y,n.X);e.addPlayer(a);var o=new v(3,"Player 3",s.Orange,n.M,n.Comma);e.addPlayer(o);var h=new v(4,"Player 4",s.Green,n.Left,n.Down);e.addPlayer(h);var l=new v(5,"Player 5",s.Pink,n.P,n.SZ);e.addPlayer(l);var d=new v(6,"Player 6",s.Blue,r.Left,r.Right);e.addPlayer(d);new y(t,e)})}}]);
//# sourceMappingURL=app.js.map